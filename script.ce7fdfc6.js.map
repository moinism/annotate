{"version":3,"sources":["script.js"],"names":["readFile","file","Promise","resolve","reject","reader","FileReader","onload","e","target","result","onerror","readAsDataURL","onFilesSelected","files","dataTransfer","index","then","src","APP","images","push","name","catch","console","error","length","setTranslate","xPos","yPos","el","style","transform","setDimensions","w","h","width","height","drag","active","preventDefault","type","currentX","touches","clientX","initialX","currentY","clientY","initialY","xOffset","yOffset","moveItem","dragStart","dragEnd","onDragEnd","dragItem","container","defaultLabelWH","defaultCoords","x","y","Vue","created","data","current","label","completed","fromCenter","currentLabelX","currentLabelY","currentLabelW","currentLabelH","currentImageW","currentImageH","activeTool","activeColor","methods","onImageLoad","$image","image","onImageChange","coords","coordinates","onLabelChange","done","annotations","forEach","item","nextImage","next","prevImage","prev","parseInt","Math","round","onDragOver","dropEffect","onDrop","document","addEventListener","getElementById","classList","add"],"mappings":"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","file":"script.ce7fdfc6.js","sourceRoot":"src","sourcesContent":["function readFile(file) {\n  return new Promise(function (resolve, reject) {\n    var reader = new FileReader()\n    reader.onload = function (e) {\n      resolve(e.target.result)\n    }\n    reader.onerror = (e) => reject(e)\n    reader.readAsDataURL(file)\n  })\n}\n\nfunction onFilesSelected (e) {\n  let files = (e.dataTransfer || e.target).files;\n  for (let index = 0; index < files.length; index++) {\n    let file = files[index]\n\n    readFile(file).then(src => {\n      APP.images.push({\n        src: src,\n        name: file.name,\n      })\n    }).catch(console.error)\n  }\n}\n\nfunction setTranslate(xPos, yPos, el) {\n  el.style.transform = \"translate3d(\" + xPos + \"px, \" + yPos + \"px, 0)\";\n}\n\nfunction setDimensions(w, h, el) {\n  el.style.width = w + 'px';\n  el.style.height = h + 'px';\n}\n\nfunction drag(e) {\n  if (active) {\n    e.preventDefault();\n\n    if (e.type === \"touchmove\") {\n      currentX = e.touches[0].clientX - initialX;\n      currentY = e.touches[0].clientY - initialY;\n    } else {\n      currentX = e.clientX - initialX;\n      currentY = e.clientY - initialY;\n    }\n\n    xOffset = currentX;\n    yOffset = currentY;\n\n    setTranslate(currentX, currentY, moveItem);\n  }\n}\n\nfunction dragStart(e) {\n  if (e.type === \"touchstart\") {\n    initialX = e.touches[0].clientX - xOffset;\n    initialY = e.touches[0].clientY - yOffset;\n  } else {\n    initialX = e.clientX - xOffset;\n    initialY = e.clientY - yOffset;\n  }\n}\n\nfunction dragEnd(e) {\n  initialX = currentX;\n  initialY = currentY;\n\n  active = false;\n\n  APP.onDragEnd(moveItem)\n}\n\nvar moveItem;\nvar dragItem;\nvar container;\n\nvar currentX;\nvar currentY;\nvar initialX;\nvar initialY;\n\nvar xOffset = 0;\nvar yOffset = 0;\n\nvar active = false;\n\nvar defaultLabelWH = 40;\nvar defaultCoords = {\n  x: 10,\n  y: 10,\n  width: defaultLabelWH,\n  height: defaultLabelWH,\n}\n\nvar APP = new Vue({\n  el: '#app',\n  created: function () {},\n  data: {\n    current: 0,\n    label: '',\n    images: [],\n    completed: [],\n    fromCenter: false,\n\n    currentLabelX: 0,\n    currentLabelY: 0,\n    currentLabelW: defaultLabelWH,\n    currentLabelH: defaultLabelWH,\n\n    currentImageW: 900,\n    currentImageH: 600,\n\n    activeTool: 'rect',\n    activeColor: 'ann-blue',\n  },\n  methods: {\n    onFilesSelected: (e) => {\n      onFilesSelected(e)\n    },\n\n    onImageLoad: function (e, index) {\n      let $image = e.target\n      let image = APP.images[index]\n\n      image.width = $image.width\n      image.height = $image.height\n    },\n\n    onImageChange: function () {\n      let image = APP.images[APP.current]\n\n      APP.currentImageW = image.width\n      APP.currentImageH = image.height\n\n      let coords = image.coordinates || defaultCoords\n\n      APP.currentLabelW = coords.width\n      APP.currentLabelH = coords.height\n\n      xOffset = coords.x\n      yOffset = coords.y\n      setTranslate(coords.x, coords.y, moveItem)\n      setDimensions(coords.width, coords.height, moveItem)\n\n      APP.label = image.label || ''\n    },\n\n    onLabelChange: function () {\n      let image = APP.images[APP.current]\n      image.label = APP.label\n\n      let coordinates = {\n        x: APP.currentLabelX ,\n        y: APP.currentLabelY,\n        width: APP.currentLabelW,\n        height: APP.currentLabelH,\n      }\n\n      image.coordinates = coordinates\n\n      let done = APP.completed\n\n      done[APP.current] = {\n        image: image.name,\n        annotations: [\n          {\n            label: image.label,\n            coordinates: coordinates\n          }\n        ]\n      }\n\n      APP.completed = []\n      done.forEach(item => {\n        APP.completed.push(item)\n      })\n    },\n\n    nextImage: function () {\n      let next = APP.current + 1\n      if (next > APP.images.length - 1) {\n        next = 0\n      }\n\n      APP.current = next\n      APP.onImageChange()\n    },\n\n    prevImage: function () {\n      let prev = APP.current - 1\n      if (prev < 0) {\n        prev = APP.images.length - 1\n      }\n\n      APP.current = prev\n      APP.onImageChange()\n    },\n\n    onDragEnd: function (e) {\n      APP.currentLabelW = parseInt(e.style.width) || defaultLabelWH\n      APP.currentLabelH = parseInt(e.style.height) || defaultLabelWH\n\n      APP.currentLabelX = APP.fromCenter ? xOffset + Math.round(APP.currentLabelW/2) : xOffset\n      APP.currentLabelY = APP.fromCenter ? yOffset + Math.round(APP.currentLabelH/2) : yOffset\n    },\n\n    onDragOver: (e) => {\n      e.dataTransfer.dropEffect = 'copy'\n    },\n\n    onDrop: (e) => {\n      onFilesSelected(e)\n    },\n  }\n})\n\n\ndocument.addEventListener('DOMContentLoaded', () => { // check support for arrow functions\n  document.getElementById('browser-request').classList.add('hidden')\n\n  moveItem = document.getElementById('moveitem');\n  dragItem = document.getElementById('dragitem');\n  container = document.getElementById('draglayer');\n\n  container.addEventListener(\"touchstart\", dragStart, false);\n  container.addEventListener(\"touchend\", dragEnd, false);\n  container.addEventListener(\"touchmove\", drag, false);\n\n  dragItem.addEventListener(\"mousedown\", () => {\n    active = true\n  }, false);\n  dragItem.addEventListener(\"mouseup\", () => {\n    active = false\n  }, false);\n\n  container.addEventListener(\"mousedown\", dragStart, false);\n  container.addEventListener(\"mouseup\", dragEnd, false);\n  container.addEventListener(\"mousemove\", drag, false);\n})"]}